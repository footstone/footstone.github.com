---
layout: post
title: 基于Kerberos协议集成Active Directory
---

##### 背景

从结构化的系统构建思路上来考虑，应用系统的很多基础的非核心业务功能可以抽离成独立的公用的功能模块或子系统来支撑多个核心主业务系统。比如电信运营支撑系统中通常有大量的业务子系统，如订单、客户、计费、资源等等，其中每一个系统都会面临一些共同的非业务功能需求，如安全控制、权限管理、用户认证等。在各项资源条件具备的情况下，这些功能需求都可以通过各自构建独立的子系统来支撑。如此横向拆分系统，一方面可以使各系统更关注于自身领域，另一方面也使得管控维护变得更加容易。所以现在有越来越多的统一XX——统一认证、统一权限、统一支付、统一接口......

其实正是由于一直坚持这种系统构建思路，才使得我们能渐渐沉淀出越来越多的产品。也正是得益于这种思路，这次碰到的Active Directory集成工作才能相对简单的实现。

Active Directory接管的是认证，并希望达到在成功认证AD之后，即能进入业务系统而不需要再次登录。也就是希望能将现有的认证系统切换成AD，并且业务系统能够认可AD的认证结果。如果各个业务系统都要做一次跟AD的集成，那对现有业务系统冲击太大，而且工作量也是相当巨大的。所以，可以将AD集成的工作完全安排在统一认证中心上（SSO Server）。SSO原本只是作为解决业务系统间嵌套页面的问题而存在，同时负责认证和会话管理，如今只是将认证转变成了与AD之间的认证通信。

##### 实现方案

其实，与AD集成只有两个事情需要考虑：
* AD域账号与业务系统账号的绑定关系维护。
* 用户访问到系统时，系统如何能识别到有效的AD域账号。

第一点可以通过账号维护管理来实现，这里重点记录基于Kerberos协议获取当前登录的有效AD域账号的过程。


<img src="http://i1371.photobucket.com/albums/ag283/njzeroc/Develop/AuthenticatorwithKerberos_zps465c130b.jpeg" width="500px"/>



##### 资料

Active Directory:

Kerberos:

SPNEGO:


